# 拼多多聊天监控器 - 新增功能说明

## 🆕 新增功能

### 1. 📄 TXT文档批量导入功能

#### 功能特点：
- **支持TXT文档导入**：可以直接导入包含拼多多客服链接的TXT文档
- **智能链接识别**：自动识别和验证拼多多相关链接
- **批量处理**：支持大量链接的批量导入和处理
- **预览功能**：导入前可以预览链接的有效性
- **自动打开**：导入后可以选择自动打开所有链接
- **自动监听**：导入后可以选择自动开启聊天监听

#### 使用方法：
1. 在"批量链接"标签页中找到"TXT文档批量导入"区域
2. 点击"📥 导入TXT文档"按钮选择TXT文件
3. 选择是否"导入后自动打开链接"和"导入后自动开启监听"
4. 点击"👁️ 预览链接"可以查看链接的有效性
5. 导入成功后，链接会自动添加到批量链接列表中

#### 支持的链接格式：
- 商品详情页：`https://mobile.yangkeduo.com/goods.html?goods_id=xxx`
- 聊天页面：`https://mobile.yangkeduo.com/chat_detail.html?goods_id=xxx`
- 商品详情：`https://mobile.yangkeduo.com/goods_detail.html?goods_id=xxx`
- 商城页面：`https://mobile.yangkeduo.com/mall.html?mall_id=xxx`
- 聊天页面：`https://mobile.yangkeduo.com/chat.html?chat_id=xxx`

#### 文件要求：
- 文件格式：仅支持 .txt 文件
- 文件大小：不超过 2MB
- 链接格式：每行一个链接
- 编码格式：支持 UTF-8 编码

### 2. 🔧 修复的发送消息功能

#### 改进内容：
- **增强的输入框查找**：使用多种选择器查找聊天输入框
- **智能内容设置**：多种方式设置输入框内容，提高成功率
- **改进的发送按钮查找**：更全面的发送按钮识别
- **备用发送方式**：支持回车键发送作为备用方案
- **错误处理**：更好的错误处理和重试机制
- **状态反馈**：实时反馈发送状态和结果

#### 技术改进：
- 使用多种选择器查找输入框和发送按钮
- 支持多种方式设置输入框内容（value、textContent、execCommand等）
- 改进的事件触发机制
- 更好的页面加载等待机制
- 完善的错误处理和日志记录

#### 新增函数：
- `sendAIMessageToPddChat(message)`：专门用于发送AI回复消息
- 改进的 `sendMessageToCustomer(message)`：更稳定的消息发送功能

## 🎯 使用场景

### 场景1：批量导入客服链接
1. 准备包含拼多多客服链接的TXT文档
2. 使用TXT文档导入功能批量导入
3. 选择自动打开和监听
4. 系统会自动处理所有链接

### 场景2：自动回复客服消息
1. 配置API接口和拼多多设置
2. 开启聊天监控
3. 系统自动检测客服消息
4. 自动发送AI回复

### 场景3：批量发送消息
1. 导入多个客服链接
2. 输入要发送的消息内容
3. 选择自动发送到所有链接
4. 系统逐个发送消息

## 📋 配置说明

### TXT文档格式示例：
```
https://mobile.yangkeduo.com/goods.html?goods_id=123456789&mall_id=987654321
https://mobile.yangkeduo.com/chat_detail.html?goods_id=123456789&mall_id=987654321
https://mobile.yangkeduo.com/goods_detail.html?goods_id=123456789
```

### 重要配置项：
- **API端点**：配置后端AI接口地址
- **PDD用户ID**：配置拼多多用户ID
- **自动发送**：是否自动发送AI回复
- **自动粘贴**：是否优先使用自动粘贴发送

## ⚠️ 注意事项

1. **链接格式**：确保TXT文档中的链接格式正确
2. **文件大小**：TXT文件不要超过2MB
3. **网络环境**：确保网络连接稳定
4. **浏览器权限**：确保扩展有足够权限
5. **API配置**：确保后端API接口正常工作

## 🔧 故障排除

### 常见问题：
1. **导入失败**：检查文件格式和大小
2. **链接无效**：检查链接格式是否正确
3. **发送失败**：检查网络连接和页面状态
4. **监听失败**：检查页面是否为拼多多聊天页面

### 调试方法：
1. 查看浏览器控制台日志
2. 检查扩展的popup页面状态
3. 验证API接口是否正常
4. 确认页面元素是否正确加载

## 📈 性能优化

- 批量处理时使用合理的间隔时间
- 避免同时处理过多链接
- 定期清理无效链接
- 监控内存使用情况

---

**版本**：v2.1.0  
**更新日期**：2024年  
**兼容性**：Chrome 88+

